<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Document</title>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <div class="row">
          <div class="col-md-1"></div>
            <div class="col-md-10">
              <div class="form-group">
                <form name="add_name" id="add_name" onsubmit="return false">
                  <table class="table table-bordered table-hover" id="dynamic_field">
                    <tr>
                      <td><input type="text" name="script[]" placeholder="Enter Script ID" class="form-control name_list" id="script" /></td>
                      <td><input type="text" name="dependencies[]" placeholder="Enter dependencies in []" class="form-control name_email" id="dependency"/></td>
                      <td><button type="button" name="add" id="add" class="btn btn-primary">Add More</button></td>  
                    </tr>
                  </table>
                  <input type="submit" class="btn btn-success" name="submit" id="submit" value="Submit">
                </form>
              </div>
            </div>
          <div class="col-md-1"></div>
          <div id="#stage2"></div>
        </div>
      </div>
</body>
<script src="index.js"></script>
<script>
     $(document).ready(function(){
   
   var i = 1;
     var length;
     //var addamount = 0;
    var addamount = 700;
 
   $("#add").click(function(){
     
    //   <!-- var rowIndex = $('#dynamic_field').find('tr').length;	 -->
    //   <!-- console.log('rowIndex: ' + rowIndex); -->
    //   <!-- console.log('amount: ' + addamount); -->
    //   <!-- var currentAmont = rowIndex * 700; -->
    //   <!-- console.log('current amount: ' + currentAmont); -->
    //   <!-- addamount += currentAmont; -->
      
      //addamount += 700;
      //console.log('amount: ' + addamount);
    i++;
       $('#dynamic_field').append('<tr id="row'+i+'"><td><input type="text" name="script[]" id="script" placeholder="Enter Script ID" class="form-control name_list"/></td><td><input type="text" name="dependencies[]" id="dependency" placeholder="Enter dependencies in []" class="form-control name_email"/></td>	<td><button type="button" name="remove" id="'+i+'" class="btn btn-danger btn_remove">X</button></td></tr>');  
     });
 
   $(document).on('click', '.btn_remove', function(){  
    
    //  <!-- var rowIndex = $('#dynamic_field').find('tr').length;	 -->
    //   <!-- addamount -= (700 * rowIndex); -->
    //   <!-- console.log(addamount); -->
      
       var button_id = $(this).attr("id");     
       $('#row'+button_id+'').remove();  
     });
     
 
 
     $("#submit").on('click',function(event){
        event.preventDefault()
        var formdata = $("#add_name").serialize();
        //var formdata = $("#add_name").serializeArray()
        //console.log(formdata);
     
        var elem = document.getElementsByTagName("input");
        var scripts = [];
        var dependencies = [];
        for (var i = 0; i < elem.length; ++i) {

        if (typeof elem[i].attributes.id !== "undfined") {
            //console.log(elem[i].id);
                if(elem[i].id === "script"){
                   
                    scripts.push(Number(elem[i].value));
                }else if(elem[i].id === "dependency"){
                    dependencies.push(elem[i].value!=''?elem[i].value.split(',').map(Number):[]);
                }
            }
        }
       
       

        var vulnerabilityScripts=[];
        for(var i=0;i<scripts.length;i++){
            vulnerabilityScripts.push( new VulnerabilityScript(scripts[i], dependencies[i]))
        }

        //console.log("vulnerabilityScripts: ", vulnerabilityScripts)
        var NonDependencyScripts = executeNonDependentScripts(vulnerabilityScripts);
        var unExecuted=[];
        NonDependencyScripts.map((sid)=>{
            unExecuted = vulnerabilityScripts.filter(function (script) { return script.getScriptId() != sid; });
        })
        
    
        var ExecutedOrder = executeProcess(unExecuted,NonDependencyScripts)

        if(ExecutedOrder.length==scripts.length)
            alert(ExecutedOrder);
        else
            alert("Either there is Circular deendency Or Script is missing")
        
       
     });
   });
</script>

</html>